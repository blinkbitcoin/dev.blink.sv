(self.webpackChunkdev_blink_sv=self.webpackChunkdev_blink_sv||[]).push([[26],{1089:(e,t,i)=>{"use strict";i.r(t),i.d(t,{assets:()=>g,contentTitle:()=>p,default:()=>y,frontMatter:()=>h,metadata:()=>x,toc:()=>m});var s=i(4848),n=i(8453),a=i(6540);const l=e=>{const[t,i]=(0,a.useState)(e?"loading":"idle");return(0,a.useEffect)((()=>{if(!e)return void i("idle");let t=document.querySelector(`script[src="${e}"]`);if(!t)return t=document.createElement("script"),t.src=e,t.async=!0,t.onload=()=>i("ready"),t.onerror=()=>i("error"),document.body.appendChild(t),()=>{document.body.removeChild(t)};i("ready")}),[e]),t};var d=i(1396),r=i.n(d);const o={"038f8f113c580048d847d6949371726653e02b928196bad310e3eda39ff61723f6":"Muun wallet","03a6ce61fcaacd38d31d4e3ce2d506602818e3856b4b44faff1dde9642ba705976":"Muun wallet","025eee29468652d3a05c7ecb32c50ab5f3d3ebfa2115acccacae905ceaf6f30a23":"Muun wallet","025cd6a9c52507da0a3ba832b4f698c73558a8c9e32da10d882b0cefad9cb36a76":"Muun wallet","03864ef025fde8fb587d989186ce6a4a186895ee44a926bfc370e2c366597a3f8f":"Phoenix wallet","03933884aaf1d6b108397e5efe5c86bcf2d8ca8d2f700eda99db9214fc2712b134":"Phoenix wallet (testnet)","02dd3fcdaa17b9bc83bf7138fbea85d0e83385a68b5fc8f9933658c8ee04644f68":"the Fedi wallet","02a98e8c590a1b5602049d6b21d8f4c8861970aa310762f42eae1b2be88372e924":"a wallet using Spark","039174f846626c6053ba80f5443d0db33da384f1dde135bf7080ba1eec465019c3":"a wallet using Spark","030936e7a016fb3f5ce53c8db29da2b6dfbf8e068ea058c363e0fd77f444270d8a":"a wallet using Spark","038f83dae5dfcc8566b21d4fd5f28b8cc1d754c95cad6b9009c3e9522ed1156de3":"a wallet using Ark (by Ark Labs)"};function c(){const[e,t]=(0,a.useState)(""),[i,n]=(0,a.useState)(""),[d,c]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)({}),[m,u]=(0,a.useState)(null),[y,j]=(0,a.useState)(""),[v,f]=(0,a.useState)(!1),[b,w]=(0,a.useState)(!0),[k,S]=(0,a.useState)([]),[C,L]=(0,a.useState)(null),[N,$]=(0,a.useState)(""),[T,W]=(0,a.useState)(null),[P,D]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=new URLSearchParams(window.location.search);let i=e.get("invoice")||"",s=e.get("lnaddress")||"";i=i.startsWith("lightning:")?i.substring(10):i,s=s.startsWith("lightning:")?s.substring(10):s,i?t(i):s&&t(s)}),[]),(0,a.useEffect)((()=>{i&&""!==e&&i&&V(i)}),[i,e]);const R=l("/js/bolt11.min.js");if("loading"===R)return(0,s.jsx)("p",{children:"Loading script..."});if("error"===R)return(0,s.jsx)("p",{children:"Error loading script."});const H=()=>{try{let t,s,n,a=i.toLowerCase();a.toLowerCase().startsWith("lightning:")&&(a=a.substring(10)),a.startsWith("lnbc")?(t="mainnet",s={bech32:"bc",pubKeyHash:66,scriptHash:255,validWitnessVersions:[0,2,3,4,5]}):a.startsWith("lntbs")?(t="signet",s={bech32:"tbs",pubKeyHash:66,scriptHash:255,validWitnessVersions:[0,2,3,4,5]}):a.startsWith("lntb")&&(t="testnet",s={bech32:"tb",pubKeyHash:66,scriptHash:255,validWitnessVersions:[0,2,3,4,5]});try{n=lightningPayReq.decode(a,s),c(n);const e=n.tags.find((e=>"payment_hash"===e.tagName))?.data,i=new Date(1e3*n.timestamp),l=i.toISOString().replace("T"," ").replace(/\.\d{3}Z$/,"Z"),d=n.tags.find((e=>"expire_time"===e.tagName))?.data;let r;if(d){const e=new Date(i.getTime()+1e3*d),t=new Date;if(e<t){r=`expired since ${Math.round((t-e)/6e4)} minutes`}else{const i=Math.round(d/60);r=`${Math.round((e-t)/6e4)} minutes remaining out of ${i}`}}else r="N/A";const o=n.tags?.find((e=>"description"===e.tagName))?.data||"",h=n.tags?.some((e=>"routing_info"===e.tagName&&e.data&&e.data.length>0));let x=[];h&&(x=n.tags.filter((e=>"routing_info"===e.tagName)).flatMap((e=>e.data.map((e=>e.pubkey))))),g({invoice:n.paymentRequest,network:t,payeeNodeKey:n.payeeNodeKey,satoshis:n.satoshis,millisatoshis:n.millisatoshis,paymentHash:e,timestampString:l,expirationStatus:r,memo:o,link:F(n.payeeNodeKey,t),routingHintPubKeys:x}),"mainnet"===t&&n.payeeNodeKey?_(n.payeeNodeKey):n.payeeNodeKey?p({message:`No more details are fetched for ${t}`}):p(null),"mainnet"===t&&x.length>0?(S([]),x.forEach((e=>K(e)))):x.length>0?x.forEach((e=>S((i=>[...i,{hintPubkey:e,message:`No more details are fetched for ${t}`}])))):S([]),u(null)}catch(e){w(!1),console.error("Decoding failed: ",e.message),u("Decoding failed: "+e.message)}}catch(t){g({}),u("Failed to decode invoice. Please check the format.")}},F=(e,t)=>({mainnet:[{url:`https://mempool.space/lightning/node/${e}`,name:"mempool.space"},{url:`https://amboss.space/node/${e}`,name:"amboss.space"},{url:`https://1ml.com/node/${e}`,name:"1ml.com"},{url:`https://lightningnetwork.plus/nodes/${e}`,name:"lightningnetwork.plus"}],testnet:[{url:`https://mempool.space/${t}/lightning/node/${e}`,name:"mempool.space/testnet"},{url:`https://1ml.com/testnet/node/${e}`,name:"1ml.com/testnet"}],signet:[{url:`https://mempool.space/${t}/lightning/node/${e}`,name:"mempool.space/signet"}]}[t]||[]),_=async e=>{try{console.log(`Fetching node data for ${e}`);const t=await fetch(`https://mempool.space/api/v1/lightning/nodes/${e}`);if(!t.ok)throw p(null),new Error("Network response was not ok");const i=await t.json();"This node does not exist, or our node is not seeing it yet"===i.message?p(null):p(i)}catch(t){console.error("Failed to fetch node data:",t),p(null)}},K=async e=>{try{console.log(`Fetching routing hint data for ${e}`);const t=await fetch(`https://mempool.space/api/v1/lightning/nodes/${e}`);if(!t.ok)return void S((t=>[...t,{hintPubkey:e,message:"Network response was not ok"}]));const i=await t.json();"This node does not exist, or our node is not seeing it yet"===i.message?S((t=>[...t,{hintPubkey:e,message:"This node does not exist or the mempool.space node is not seeing it yet"}])):S((t=>[...t,{hintPubkey:e,...i}]))}catch(t){console.error("Failed to fetch routing hint data:",t),S((i=>[...i,{hintPubkey:e,message:`Failed to fetch routing hint data: ${t.toString()}`}]))}},M=async e=>{try{const[t,i]=e.split("@"),s=await fetch(`https://${i}/.well-known/lnurlp/${t}`);if(!s.ok)throw new Error("Network response was not ok");const n=await s.json();L(n)}catch(t){console.error("Failed to resolve lightning address:",t),u("Failed to resolve lightning address: "+t.message),L(null)}},A={display:"flex",marginBottom:"5px"},E={minWidth:"130px",fontWeight:"bold",marginLeft:"10px"},O={border:"none",background:"none",width:"100%",maxWidth:"500px",overflow:"auto",whiteSpace:"nowrap",fontSize:"inherit",fontFamily:"inherit",cursor:"pointer",outline:"none",textOverflow:"ellipsis"},I=e=>{navigator.clipboard.writeText(e).then((()=>{j("Copied to clipboard"),setTimeout((()=>{j("")}),2e3)}),(e=>{console.error("Could not copy text: ",e),j("Failed to copy to clipboard."),setTimeout((()=>{j("")}),2e3)}))},U=()=>{let t="";const s=window.location.origin+window.location.pathname;if(i){let e=i.toLowerCase();e.startsWith("lightning:")&&(e=e.substring(10)),e.startsWith("ln")?t=`${s}?invoice=${encodeURIComponent(i)}`:e.includes("@")&&(t=`${s}?lnaddress=${encodeURIComponent(i)}`)}else if(e){let i=e.toLowerCase();i.startsWith("lightning:")&&(i=i.substring(10)),i.startsWith("ln")?t=`${s}?invoice=${encodeURIComponent(e)}`:i.includes("@")&&(t=`${s}?lnaddress=${encodeURIComponent(e)}`)}t&&I(t)},B=()=>{c(null),p(null),g({}),u(null),f(!1),w(!0),S([]),L(null)},J=()=>{n(""),t(""),$(""),D(!1),B()},V=()=>{B();let e=i.toLowerCase();e.startsWith("lightning:")&&(e=e.substring(10)),e.startsWith("ln")?H():e.includes("@")?M(e):u("Invalid input. Please enter a valid lightning invoice or lightning address.")};if(e&&!d&&b&&!C){(e=>{e.toLowerCase().startsWith("ln")?(n(e),H()):e.includes("@")&&M(e)})(e)}return(0,s.jsxs)("div",{children:[""===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("textarea",{value:i,onChange:e=>n(e.target.value),style:{width:"100%",maxWidth:"500px",height:"7em",overflow:"auto"},placeholder:"Paste a lightning invoice or a lightning address"}),(0,s.jsx)("br",{}),(0,s.jsx)("button",{onClick:V,children:"Decode"}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{style:{marginLeft:"10px"},onClick:J,children:"Clear"}),(0,s.jsx)("button",{style:{marginLeft:"10px"},onClick:U,children:"Share"})]})]}),e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"text",value:e,style:O,readOnly:!0,onClick:()=>I(e),title:"Click to copy"}),(0,s.jsx)("br",{}),(0,s.jsx)("button",{style:{marginLeft:"10px"},onClick:J,children:"Clear"}),(0,s.jsx)("button",{style:{marginLeft:"10px"},onClick:U,children:"Share"})]}),(0,s.jsx)("div",{style:{marginTop:"10px"}}),(()=>{if(!C)return null;const e={minWidth:"150px",fontWeight:"bold",marginLeft:"10px"};let t={};try{JSON.parse(C.metadata).forEach((e=>{"text/plain"===e[0]?t.description=e[1]:"text/identifier"===e[0]&&(t.lnaddress=e[1])}))}catch(i){console.error("Error parsing metadata:",i)}return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"Lightning Address Data"}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Callback URL:"}),(0,s.jsx)("div",{children:C.callback})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Min Sendable:"}),(0,s.jsxs)("div",{children:[C.minSendable/1e3," sats"]})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Max Sendable:"}),(0,s.jsxs)("div",{children:[C.maxSendable/1e3," sats"]})]}),t.description&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Description:"}),(0,s.jsx)("div",{children:t.description})]}),t.lnaddress&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Lightning Address:"}),(0,s.jsx)("div",{children:t.lnaddress})]}),null!=C.commentAllowed&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Comment Allowed:"}),(0,s.jsxs)("div",{children:[C.commentAllowed," characters"]})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Tag:"}),(0,s.jsx)("div",{children:C.tag})]}),C.allowsNostr&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Nostr:"}),(0,s.jsx)("div",{children:"Allowed"})]}),C.nostrPubkey&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:e,children:"Nostr Pubkey:"}),(0,s.jsx)("div",{children:C.nostrPubkey})]})]})})(),m&&(0,s.jsx)("div",{style:{color:"red"},children:m}),d&&(0,s.jsxs)("div",{children:[x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h3",{children:"Invoice data"}),(0,s.jsx)("div",{style:{marginTop:"10px"}}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"network:"}),(0,s.jsx)("div",{children:x.network})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"amount:"}),(0,s.jsx)("div",{children:(q=x.satoshis,z=x.millisatoshis,q&&q>=1?`${q} sats`:z?`${z} millisats`:"N/A")})]}),""!==x.memo&&(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"description:"}),(0,s.jsx)("div",{children:x.memo})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"expiry:"}),(0,s.jsx)("div",{children:x.expirationStatus})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"created at:"}),(0,s.jsx)("div",{children:x.timestampString})]}),(0,s.jsx)("div",{style:E,children:"payment hash:"}),(0,s.jsx)("input",{type:"text",value:x.paymentHash,style:{...O,marginLeft:"20px"},readOnly:!0,onClick:()=>I(x.paymentHash),title:"Click to copy and scroll"}),k&&k.length>0&&(0,s.jsxs)("div",{style:{marginTop:"10px"},children:[(0,s.jsx)("h3",{children:"Routing Hint Data"}),k.map(((e,t)=>(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[!e.message&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"alias:"}),(0,s.jsx)("div",{children:e.alias})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"public channels:"}),(0,s.jsx)("div",{children:e.active_channel_count})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"public capacity:"}),(0,s.jsxs)("div",{children:[e.capacity/1e8," btc"]})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"last update:"}),(0,s.jsxs)("div",{children:[Math.round((Date.now()/1e3-e.updated_at)/60)," minutes ago"]})]})]}),(0,s.jsx)("div",{style:E,children:"public key:"}),(0,s.jsx)("input",{type:"text",value:e.hintPubkey,style:{...O,marginLeft:"20px"},readOnly:!0,onClick:()=>I(e.hintPubkey),title:"Click to copy and scroll"}),o[e.hintPubkey]&&(0,s.jsxs)("div",{style:{marginLeft:"10px",marginTop:"10px",marginBottom:"10px"},children:["This invoice was likely generated with ",o[e.hintPubkey],"."]}),e.message&&(0,s.jsx)("div",{style:A,children:(0,s.jsx)("div",{style:{marginLeft:"10px",marginTop:"10px",marginBottom:"10px"},children:e.message})}),(0,s.jsx)("div",{style:A,children:(0,s.jsx)("div",{style:E,children:"explore:"})}),(0,s.jsx)("div",{children:F(e.hintPubkey,x.network).map(((e,t)=>(0,s.jsx)("div",{style:{display:"inline-block",paddingLeft:"20px"},children:(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},t)))})]},t)))]}),(0,s.jsx)("div",{style:{marginTop:"10px"}}),(0,s.jsx)("h3",{children:"Destination node data"}),h&&!h.message&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"alias:"}),(0,s.jsx)("div",{children:h.alias})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"public channels:"}),(0,s.jsx)("div",{children:h.active_channel_count})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"public capacity:"}),(0,s.jsxs)("div",{children:[h.capacity/1e8," btc"]})]}),(0,s.jsxs)("div",{style:A,children:[(0,s.jsx)("div",{style:E,children:"last update:"}),(0,s.jsxs)("div",{children:[Math.round((Date.now()/1e3-h.updated_at)/60)," minutes ago"]})]})]}),(0,s.jsx)("div",{style:E,children:"public key:"}),(0,s.jsx)("input",{type:"text",value:x.payeeNodeKey,style:{...O,marginLeft:"20px"},readOnly:!0,onClick:()=>I(x.payeeNodeKey),title:"Click to copy and scroll"}),h&&h.message&&(0,s.jsx)("div",{style:{marginLeft:"10px",marginTop:"10px",marginBottom:"10px"},children:h.message}),h?(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:A,children:(0,s.jsx)("div",{style:E,children:"explore:"})}),F(x.payeeNodeKey,x.network).map(((e,t)=>(0,s.jsx)("div",{style:{display:"inline-block",paddingLeft:"20px"},children:(0,s.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:e.name})},t)))]}):(0,s.jsx)("div",{style:{marginLeft:"10px",marginTop:"10px"},children:"No public data is available about this node"})]}),y&&(0,s.jsx)("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"orange",color:"black",padding:"10px",borderRadius:"10px",zIndex:1e3},children:y})]}),(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(d||C)&&(0,s.jsx)("button",{onClick:()=>{f(!v)},children:v?"Hide Raw Data":"Show Raw Data"}),v&&(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[d&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Raw Invoice Data"}),(0,s.jsx)("pre",{style:{marginLeft:"10px",marginTop:"10px"},children:JSON.stringify(d,null,2)})]}),h&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Raw Node Data"}),(0,s.jsx)("pre",{style:{marginLeft:"10px",marginTop:"10px"},children:JSON.stringify(h,null,2)})]}),k&&k.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Raw Routing Hint Data"}),(0,s.jsx)("pre",{style:{marginLeft:"10px",marginTop:"10px"},children:JSON.stringify(k,null,2)})]}),C&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{children:"Raw Lightning Address Data"}),(0,s.jsx)("pre",{style:{marginLeft:"10px",marginTop:"10px"},children:JSON.stringify(C,null,2)})]})]})]}),x.paymentHash&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{style:{marginTop:"20px"},children:[(0,s.jsx)("h3",{children:"Know the preimage? Verify it below:"}),(0,s.jsx)("input",{type:"text",value:N,onChange:e=>$(e.target.value),placeholder:"Enter the preimage",style:{width:"100%",maxWidth:"500px"}}),(0,s.jsx)("div",{}),(0,s.jsx)("button",{onClick:()=>{try{const e=r().enc.Hex.parse(N),t=r().SHA256(e).toString(r().enc.Hex);t===x.paymentHash?(W("The preimage hashed matches the payment hash. This proves that the invoice was paid."),D(!0)):(W("The preimage hashed does not match the payment hash."),D(!1))}catch(e){u("Error verifying payment: "+e.message)}},children:"Verify Payment"})]}),T&&(0,s.jsx)("div",{style:{marginTop:"10px",color:P?"green":"red",fontWeight:"bold"},children:T})]})]});var q,z}const h={id:"decode",title:"Decode a lightning invoice",slug:"/decode"},p="LN invoice decoder",x={id:"decode",title:"Decode a lightning invoice",description:"Using the bolt11 nodejs package in the browser.",source:"@site/docs/decode.mdx",sourceDirName:".",slug:"/decode",permalink:"/decode",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"decode",title:"Decode a lightning invoice",slug:"/decode"}},g={},m=[];function u(e){const t={a:"a",h1:"h1",p:"p",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"ln-invoice-decoder",children:"LN invoice decoder"}),"\n","\n",(0,s.jsx)(c,{}),"\n",(0,s.jsx)("br",{}),"\n",(0,s.jsxs)(t.p,{children:["Using the ",(0,s.jsx)(t.a,{href:"https://www.npmjs.com/package/bolt11",children:"bolt11 nodejs package"})," in the browser.",(0,s.jsx)("br",{}),"\nThe destination node data is queried from the ",(0,s.jsx)(t.a,{href:"https://mempool.space/docs/api/rest#get-node-stats",children:"mempool.space API"}),"."]})]})}function y(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},477:()=>{}}]);