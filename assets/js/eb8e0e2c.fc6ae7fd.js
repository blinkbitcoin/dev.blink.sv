"use strict";(self.webpackChunkdev_blink_sv=self.webpackChunkdev_blink_sv||[]).push([[4471],{3394:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var i=t(4848),a=t(8453);const o={id:"proof-of-payment",title:"Proof of payment",slug:"/api/proof-of-payment"},s="Proof of Payment in Lightning",r={id:"api/proof-of-payment",title:"Proof of payment",description:"When using the Lightning Network the data is not recorded on the Bitcoin blockchain, but still there is a cryptographic proof of payment consisting of:",source:"@site/docs/api/proof-of-payment.md",sourceDirName:"api",slug:"/api/proof-of-payment",permalink:"/api/proof-of-payment",draft:!1,unlisted:!1,editUrl:"https://github.com/GaloyMoney/dev.blink.sv/edit/main/docs/api/proof-of-payment.md",tags:[],version:"current",frontMatter:{id:"proof-of-payment",title:"Proof of payment",slug:"/api/proof-of-payment"},sidebar:"apiSidebar",previous:{title:"OAuth2 integration",permalink:"/api/oauth2"},next:{title:"Error handling",permalink:"/api/errors"}},h={},l=[{value:"List invoices with proof of payment",id:"list-invoices-with-proof-of-payment",level:2},{value:"Variable to show the two most recent transactions",id:"variable-to-show-the-two-most-recent-transactions",level:3},{value:"Sample response showing the invoice, payment hash and pre-image",id:"sample-response-showing-the-invoice-payment-hash-and-pre-image",level:3},{value:"Verify the proof of payment",id:"verify-the-proof-of-payment",level:2},{value:"Decode the invoice",id:"decode-the-invoice",level:3},{value:"Verify the pre-image",id:"verify-the-pre-image",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"proof-of-payment-in-lightning",children:"Proof of Payment in Lightning"}),"\n",(0,i.jsx)(n.p,{children:"When using the Lightning Network the data is not recorded on the Bitcoin blockchain, but still there is a cryptographic proof of payment consisting of:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["the ",(0,i.jsx)(n.strong,{children:"lightning invoice"})," - contents signed by the recipient node"]}),"\n",(0,i.jsxs)(n.li,{children:["the ",(0,i.jsx)(n.strong,{children:"pre-image"})," - which the payer only receives when the invoice is paid."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"See the Blink FAQ answers for more general details:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://faq.blink.sv/blink-and-other-wallets/how-to-prove-that-a-lightning-invoice-was-paid",children:"How to prove that a lightning invoice was paid?"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://faq.blink.sv/using-blink/how-to-obtain-a-proof-of-payment-from-blink",children:"How to obtain a Proof of Payment from Blink?"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"list-invoices-with-proof-of-payment",children:"List invoices with proof of payment"}),"\n",(0,i.jsx)(n.p,{children:"Requests the two most recent transactions paid via a lightning invoice (could settle over the lightning network or internally)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-graphql",children:"query PaymentsWithProof($first: Int) {\n  me {\n    defaultAccount {\n      transactions(first: $first) {\n        edges {\n          node {\n            initiationVia {\n              ... on InitiationViaLn {\n                paymentRequest\n                paymentHash\n              }\n            }\n            settlementVia {\n              ... on SettlementViaIntraLedger {\n                preImage\n              }\n              ... on SettlementViaLn {\n                preImage\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n"})}),"\n",(0,i.jsx)(n.h3,{id:"variable-to-show-the-two-most-recent-transactions",children:"Variable to show the two most recent transactions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "first": 2\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"sample-response-showing-the-invoice-payment-hash-and-pre-image",children:"Sample response showing the invoice, payment hash and pre-image"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'{\n  "data": {\n    "me": {\n      "defaultAccount": {\n        "transactions": {\n          "edges": [\n            {\n              "node": {\n                "initiationVia": {\n                  "paymentRequest": "lntbs320n1pjehuh8pp5cf6ckqv265qu6ppul0mhv4qpw4zkmd6rcxx080f8cqaz3w5p5m2qhp5ermsf933ju2t2vzpehcndlf8kpjqa780h6kzaa5eevpq6s8a7t9qcqzpuxqyz5vqsp5xs2v586kum4lu7exwskukkf0wjyw29l50293c8scdetlvszdgdds9qyyssqgzxzle9hz6384qt8uzh74wy3ylp6g3yw74q06zelxuhxtgwk9ehxvgtmqh53furqceecm22jsv2aypcangdn2tayl0vl095qx0wh3hqpwrfl8j",\n                  "paymentHash": "c2758b018ad501cd043cfbf776540175456db743c18cf3bd27c03a28ba81a6d4"\n                },\n                "settlementVia": {\n                  "preImage": "9e92a2d24e89c92c93d2c63ffe126605bcd3bf614c727a1f6e3f52064b83c2ec"\n                }\n              }\n            },\n            {\n              "node": {\n                "initiationVia": {\n                  "paymentRequest": "lntbs10n1pjehukhpp57ngk3ddxtmytqdzcyqa4l2e87ny29rwjsqx46g6m0pvpj7tvp6vshp5at629lcgdgt53gsapw77s59ykxxn7lkxyfk4n7zdx78c65s9502scqzpuxqyz5vqsp5nru4r9hu7asuvn86euyuskzdppl3lt4xue5wl8jxawaxc5rmzynq9qyyssq4c0d6lmszx6udlw8elv6dcawlsu7069fqd60wc4xxc3v6h5lmag45f8ks9lrdwnajysc0ka3lmgchfwrjjlgx4a8dg8g7gjlqaezecgqn706p3",\n                  "paymentHash": "f4d168b5a65ec8b03458203b5fab27f4c8a28dd2800d5d235b785819796c0e99"\n                },\n                "settlementVia": {\n                  "preImage": "f3a2290961be4b91bb230cfe7ae9d8159667dd9da33ca95b7c609bf82034285c"\n                }\n              }\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"verify-the-proof-of-payment",children:"Verify the proof of payment"}),"\n",(0,i.jsx)(n.h3,{id:"decode-the-invoice",children:"Decode the invoice"}),"\n",(0,i.jsx)(n.p,{children:"The invoice can be used to identify the destination node, obtain the payment hash and analyze other contents by decoding it for example in:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://dev.blink.sv/decode",children:"dev.blink.sv/decode"})," which uses the ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/bolt11",children:"bolt11 nodejs package"})," in the browser"]}),"\n",(0,i.jsxs)(n.li,{children:["using LND:","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ lncli decodepayreq <invoice>\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["or CLN","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ lightning-cli decode <invoice>\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"verify-the-pre-image",children:"Verify the pre-image"}),"\n",(0,i.jsx)(n.p,{children:"The payment hash is the sha256 hash of the binary form of the preimage which can be verified in:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://dev.blink.sv/decode",children:"dev.blink.sv/decode"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"or in linux terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ echo -n '<preimage_in_hex>'| xxd -r -p | sha256sum\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To use the preimage as a proof of payment the calculated hash must match the payment hash in the invoice."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["To test the GraphQL requests further use the GraphQL playground at ",(0,i.jsx)(n.a,{href:"https://api.blink.sv/graphql",children:"api.blink.sv/graphql"})," for mainnet or ",(0,i.jsx)(n.a,{href:"https://api.staging.blink.sv/graphql",children:"api.staging.blink.sv/graphql"})," for staging.",(0,i.jsx)("br",{}),"\nCheck out the ",(0,i.jsx)(n.a,{href:"https://documenter.getpostman.com/view/29391384/2s9YCAQq3z#ae685bc1-d637-48b2-8e32-4600eefc9a4e",children:"Galoy API Postman collection"})," to find examples in multiple programming languages."]})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(6540);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);